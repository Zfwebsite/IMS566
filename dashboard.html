<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TaskManager • Dashboard</title>

  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet"> 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-white shadow-sm navbar-premium">
    <div class="container-fluid">
      <a class="navbar-brand fw-800 ms-2 brand-serif" href="dashboard.html"><span class="brand-icon">TM</span> TaskManager</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav me-auto ms-3 mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" href="dashboard.html">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="tasks.html">Tasks</a></li>
          <li class="nav-item"><a class="nav-link" href="completed.html">Completed</a></li>
        </ul>

        <div class="d-flex align-items-center me-3">
          <div class="me-3 text-end d-none d-md-block">
            <div class="small text-muted">Signed in as</div>
            <div id="currentUser" class="fw-600"></div>
          </div>
          <button id="logoutBtn" class="btn btn-outline-gradient-uitm"><i class="bi bi-box-arrow-right"></i></button>
        </div>
      </div>
    </div>
  </nav>

  <section class="dashboard-header py-5 text-center text-white">
    <h1 class="fw-bold display-5">Your Dashboard</h1>
    <p class="mt-2">Stay organised • Stay productive • Stay ahead</p>
</section>

<div class="container my-5">

    <div class="row g-4">

        <div class="col-md-4">
            <div class="uitm-card d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title">Total Tasks</h6>
                    <h2 id="totalTasks" class="fw-bold mb-0">0</h2>
                </div>
                <div class="icon-circle bg-purple">
                    <i class="bi bi-list-check"></i>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="uitm-card d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title">Completed</h6>
                    <h2 id="completedTasks" class="fw-bold mb-0">0</h2>
                </div>
                <div class="icon-circle bg-green">
                    <i class="bi bi-check-circle-fill"></i>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="uitm-card d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title">Completion Rate</h6>
                    <h2 id="completionRate" class="fw-bold mb-0">0%</h2>
                </div>
                <div class="icon-circle bg-gold">
                    <i class="bi bi-percent"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mt-4">

        <div class="col-lg-6">
            <div class="card shadow-sm rounded-16 p-3 h-100">
                <div class="card-body">
                    <h5 class="fw-700 mb-3">Priority Breakdown</h5>
                    <div id="priorityDonut" class="w-100"></div>

                    <hr class="my-4">

                    <h5 class="fw-700 mb-3">Weekly Task Trends</h5>
                    <div id="weeklyArea" class="w-100"></div>

                    <hr class="my-4">

                    <h5 class="fw-700 mb-3">Quick Add Task</h5>
                    <form id="quickAddForm" class="row g-3">
                        <div class="col-12">
                            <input type="text" class="form-control form-control-lg" id="quickTitle" placeholder="Task Title" required>
                        </div>
                        <div class="col-md-6">
                            <select id="quickSubject" class="form-select">
                                <option>Other</option>
                                <option>IMS566</option>
                                <option>IMS564</option>
                                <option>CTU554</option>
                                <option>ELC501</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <select id="quickPriority" class="form-select">
                                <option>Medium</option>
                                <option>High</option>
                                <option>Low</option>
                            </select>
                        </div>
                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-sm btn-gradient-uitm"><i class="bi bi-plus-lg me-2"></i> Add</button>
                        </div>
                    </form>

                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="row g-4 h-100">

                <div class="col-md-6">
                    <div class="uitm-card h-100">
                        <h6 class="card-title">Overall Progress</h6>
                        <div id="progressRadial"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="uitm-card h-100 d-flex flex-column justify-content-center">
                        <h6 class="card-title">Quote of the Day</h6>
                        <blockquote id="quoteText" class="blockquote mb-0 fw-600">
                            "Stay consistent. Small progress is still progress."
                        </blockquote>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="uitm-card h-100">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="card-title">Class Schedule</h6>
                            <div class="icon-circle bg-blue">
                                <i class="bi bi-journal-bookmark-fill"></i>
                            </div>
                        </div>
                        <ul id="scheduleList" class="mt-3 schedule-list">
                            <li><i class="bi bi-dot"></i> IMS566 – Mon, 10:00 AM (Bilik Kuliah 10)</li>
                            <li><i class="bi bi-dot"></i> IMS564 – Tue, 12:00 PM (Makmal Komputer 5)</li>
                            <li><i class="bi bi-dot"></i> CTU554 – Wed, 04:00 PM (Dewan Seminar IM)</li>
                            <li><i class="bi bi-dot"></i> ELC501 – Thu, 08:00 PM (Bilik Kuliah 9)</li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="uitm-card h-100">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="card-title">Upcoming Events</h6>
                            <div class="icon-circle bg-red">
                                <i class="bi bi-calendar-event-fill"></i>
                            </div>
                        </div>
                        <ul id="upcomingList" class="mt-3 schedule-list">
                            <li>Loading...</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

  <footer class="mt-4 text-center text-muted small py-3">
    &copy; <span id="year"></span> All right reserve ZF group
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/app.js"></script>
  <script src="assets/js/dashboard.js"></script>

  <script>
    (function() {
      // Check for login
      if (!window.TaskApp.isLoggedIn()) { location.href='index.html'; return; }

      // Set user details and year
      document.getElementById('currentUser').textContent = window.TaskApp.getCurrentUserName();
      document.getElementById('year').textContent = new Date().getFullYear();

      document.getElementById('logoutBtn').addEventListener('click', function(){ window.TaskApp.logout(); location.href='index.html'; });

      // The refresh logic is mostly handled by dashboard.js now, but the metrics update here
      function refreshAll(){
        const stats = window.TaskApp.getStats();
        document.getElementById('totalTasks').textContent = stats.total;
        document.getElementById('completedTasks').textContent = stats.completed;
        document.getElementById('completionRate').textContent = (stats.total === 0 ? '0%' : Math.round((stats.completed/stats.total)*100) + '%');

        // Charts are rendered via TaskApp API
        window.TaskApp.renderPriorityDonut('priorityDonut');
        window.TaskApp.renderProgressRadial('progressRadial');
        window.TaskApp.renderWeeklyArea('weeklyArea');
        // Upcoming list handled by dashboard.js, but ensures the TaskApp data is available
      }

      // Quick Add handler (it will automatically trigger refresh in dashboard.js via the wrapper)
      document.getElementById('quickAddForm').addEventListener('submit', function(e){
        e.preventDefault();
        const t = {
          title: document.getElementById('quickTitle').value.trim(),
          subject: document.getElementById('quickSubject').value,
          priority: document.getElementById('quickPriority').value
        };
        if (!t.title) return alert('Please enter task title.');
        window.TaskApp.addTask(t);
        this.reset();
        refreshAll(); // Force a refresh of local metrics immediately
      });

      // Initial load: The `dashboard.js` init() will handle the main refresh, but this ensures local elements are set
      refreshAll();
    })();
  </script>
</body>
</html>